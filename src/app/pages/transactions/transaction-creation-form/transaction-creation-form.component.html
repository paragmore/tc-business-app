<!-- sales-creation-form.component.html -->
<ion-content>
  <ion-header>
    <ion-toolbar>
      <ion-title> New Sale </ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-grid>
    <ion-row>
      <ion-col size-md="6">
        <ion-searchbar
          id="customer-selection-popover-button"
          placeholder="Select Customer"
        >
        </ion-searchbar>
        <ion-popover
          trigger="customer-selection-popover-button"
          [showBackdrop]="false"
          [dismissOnSelect]="true"
          [keyboardClose]="false"
        >
          <ng-template>
            <ion-content>
              <ion-list
                style="max-height: 350px; overflow-y: scroll"
                class="scrollbar"
                id="style-1"
              >
                <ion-item
                  *ngFor="let party of parties; let i = index"
                  [button]="true"
                  [detail]="false"
                  (click)="selectTransactionParty(getPartyDetails(party))"
                  ><div
                    style="display: flex; flex-direction: column; padding: 10px"
                  >
                    <p>{{ getPartyDetails(party).name }}</p>
                  </div></ion-item
                >
              </ion-list>
            </ion-content>
          </ng-template>
        </ion-popover>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col>
        <form [formGroup]="salesForm" (ngSubmit)="createSale()">
          <ion-label position="stacked">Customer Name</ion-label>
          <ion-input fill="outline"></ion-input>
          <ion-label position="stacked">Phone Number</ion-label>
          <ion-input fill="outline"></ion-input>
          <ion-label position="stacked">Address</ion-label>
          <ion-input fill="outline"></ion-input>
          <ion-label position="stacked">GSTIN</ion-label>
          <ion-input fill="outline"></ion-input>
        </form>
      </ion-col>
      <ion-col>
        <ion-card style="flex: 1; padding: 10px">
          <form [formGroup]="salesForm" (ngSubmit)="createSale()">
            <ion-label position="stacked">Invoice Number</ion-label>
            <ion-input fill="outline"></ion-input>
            <ion-label position="stacked">Invoice Date</ion-label>
            <ion-input fill="outline"></ion-input>
            <ion-label position="stacked">Your GSTIN</ion-label>
            <ion-input fill="outline"></ion-input>
            <ion-label position="stacked">State of Supply</ion-label>
            <ion-input fill="outline"></ion-input>
          </form>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <div>
    <div style="display: flex; flex-direction: row"></div>

    <!-- sales-form.component.html -->
    <div style="padding: 20px">
      <form
        *ngIf="!(screenState$ | async)?.isMobile"
        [formGroup]="salesForm"
        (ngSubmit)="createSale()"
      >
        <ion-row>
          <ion-col class="item-form-col row" size-md="4">
            <p class="subHeading" position="stacked" for="items">
              ITEM DETAILS
            </p>
          </ion-col>
          <ion-col class="item-form-col row" size="1">
            <p class="subHeading" position="stacked" for="quantity">QUANTITY</p>
          </ion-col>
          <ion-col class="item-form-col row" size="1">
            <p class="subHeading" position="stacked" for="sellingPrice">
              SELLING PRICE
            </p>
          </ion-col>
          <ion-col class="item-form-col row" size="1">
            <p class="subHeading" position="stacked" for="rate">
              RATE (INCL. DISCOUNT)
            </p>
          </ion-col>
          <ion-col class="item-form-col row" size="1">
            <p class="subHeading" position="stacked" for="discount">DISCOUNT</p>
          </ion-col>
          <ion-col class="item-form-col row" size="1">
            <p class="subHeading" position="stacked" for="gst">Tax (%)</p>
          </ion-col>
          <ion-col class="item-form-col row last" size="1">
            <p class="subHeading" position="stacked" for="amount1">
              AMOUNT (â‚¹)
            </p>
          </ion-col>
        </ion-row>
        <ion-row
          formArrayName="salesItems"
          *ngFor="let item of getFormControls.controls; let i = index"
        >
          <ion-row [formGroupName]="i">
            <ion-col class="item-form-col" size-md="4">
              <ion-input
                id="item-selection-popover-button"
                class="item-form-input"
                type="text"
                fill="outline"
                placeholder="Type or click to select an item"
                required
              ></ion-input>
              <ion-popover
                size="cover"
                trigger="item-selection-popover-button"
                [showBackdrop]="false"
                [dismissOnSelect]="true"
                [keyboardClose]="false"
              >
                <ng-template>
                  <ion-content>
                    <ion-list
                      style="max-height: 350px; overflow-y: scroll"
                      class="scrollbar"
                      id="style-1"
                    >
                      <ion-item
                        *ngFor="let product of products; let prodI = index"
                        [button]="true"
                        [detail]="false"
                        (click)="onSelectItem(product, i)"
                        ><div
                          style="
                            display: flex;
                            flex-direction: row;
                            padding: 10px;
                          "
                        >
                          <div>
                            <p>{{ product.name }}</p>
                            <p class="caption">
                              Sells price: {{ product.sellsPrice }}
                            </p>
                          </div>
                          <div class="bodySmall">
                            <p>Stock on hand</p>
                            <p>
                              {{ product.quantity }}
                            </p>
                          </div>
                        </div></ion-item
                      >
                    </ion-list>
                  </ion-content>
                </ng-template>
              </ion-popover></ion-col
            >
            <ion-col class="item-form-col" size="1">
              <ion-input
                class="item-form-input"
                fill="outline"
                type="text"
                formControlName="quantity"
              ></ion-input>
            </ion-col>
            <ion-col class="item-form-col" size="1">
              <ion-input
                class="item-form-input"
                fill="outline"
                type="text"
                required
                formControlName="sellsPrice"
              ></ion-input>
            </ion-col>
            <ion-col class="item-form-col" size="1">
              <ion-input
                class="item-form-input"
                fill="outline"
                type="number"
                required
              ></ion-input>
            </ion-col>
            <ion-col class="item-form-col" size="1">
              <ion-input
                class="item-form-input"
                fill="outline"
                type="text"
                required
              ></ion-input>
            </ion-col>
            <ion-col class="item-form-col" size="1">
              <ion-input
                class="item-form-input"
                fill="outline"
                type="number"
                required
              ></ion-input>
            </ion-col>
            <ion-col class="item-form-col last" size="1">
              <ion-input
                class="item-form-input"
                fill="outline"
                type="number"
                required
              ></ion-input>
            </ion-col>

            <div>
              <ion-icon
                style="cursor: pointer"
                (click)="removeItem(i)"
                size="large"
                name="trash-outline"
              ></ion-icon>
            </div>
          </ion-row>
        </ion-row>
        <div class="form-row">
          <div>
            <ion-button
              type="button"
              class="btn btn-success"
              (click)="addItem()"
              >Add Item</ion-button
            >
          </div>
        </div>
        <div
          class="form-row"
          style="display: flex; gap: 20px; background-color: lightgray"
        >
          <div>
            <p
              style="font-size: 12px; min-width: 140px"
              position="stacked"
              for="slNo"
            >
              Sub Total
            </p>
          </div>
          <div></div>
          <div>
            <p class="subHeading" position="stacked" for="hsnSac"></p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="quantity"></p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="unit1"></p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="sellingPrice"></p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="rate">$10,000</p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="discount">$1,000</p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="unit2"></p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="gst">$1,000</p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="amount1">$10,000</p>
          </div>
          <div>
            <p class="subHeading" position="stacked" for="amount1"></p>
          </div>
        </div>
      </form>
    </div>
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-card style="height: fit-content">
            <ion-accordion-group>
              <ion-accordion value="first">
                <ion-item slot="header" color="light">
                  <ion-label>Add optional information</ion-label>
                </ion-item>
                <div class="ion-padding" slot="content">First Content</div>
              </ion-accordion>
            </ion-accordion-group>
          </ion-card>
          <ion-card>
            <div>
              <form [formGroup]="salesForm" (ngSubmit)="createSale()">
                <ion-label position="stacked"
                  >Private notes only visible to you</ion-label
                >
                <ion-input fill="outline"></ion-input>
              </form>
            </div>
          </ion-card>
        </ion-col>
        <ion-col>
          <ion-card style="flex: 1">
            <ion-item style="display: flex; flex-direction: row">
              <ion-label>Total Amount</ion-label>
              <p>$10,000</p>
            </ion-item>
            <form [formGroup]="salesForm" (ngSubmit)="createSale()">
              <ion-item>
                <ion-label>Paid via</ion-label>
                <ion-radio-group
                  style="display: flex; flex-direction: row"
                  value="strawberries"
                >
                  <ion-radio labelPlacement="end" value="grapes"
                    >Unpaid</ion-radio
                  ><br />
                  <ion-radio labelPlacement="end" value="strawberries"
                    >Cash</ion-radio
                  ><br />
                  <ion-radio labelPlacement="end" value="pineapple"
                    >Online</ion-radio
                  ><br />
                </ion-radio-group>
              </ion-item>
              <ion-label>Amount Paid</ion-label>
              <ion-input fill="outline"></ion-input>
            </form>
            <ion-item style="display: flex; flex-direction: row">
              <ion-label>Balance Due</ion-label>
              <p>$1,000</p>
            </ion-item>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
    <div style="display: flex; flex-direction: row; margin-bottom: 100px"></div>
  </div>

  <ion-button
    style="
      display: flex;
      position: sticky;
      height: 60px;
      align-items: center;
      bottom: 0px;
      justify-content: flex-end;
      padding: 10px;
    "
    type="submit"
    class="btn btn-primary"
    >Create Sale</ion-button
  >
</ion-content>
